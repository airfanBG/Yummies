@page
@model Yummies.Pages.MealsModel
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Model.HttpContext).RequestToken;
    }
}
@{
    ViewData["Title"] = "Meals";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<style>
    img {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        width: 265px;
        height: 150px;
    }
</style>

<div class="row">
    @foreach (var meal in Model.MealViewModels)
    {
        <div class="col-md-5">
            <form id="meal">
                <div style="display:inline-block; text-align:center;">
                    <img src="~/images/@meal.Image" />
                    <p>@meal.MealName</p>
                    <p>Time for prepare: @meal.TimeForPrepare</p>
                    <p>@meal.Price <span>$</span></p>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <input id="quantity" type="number" min="1" name="Quantity" value="" />
                        <input type="text" name="MealId" value="@meal.Id" hidden />
                        <div>
                            <input id="submit" type="button" class="btn btn-success" value="Order">
                        </div>
                    }
                </div>

            </form>
        </div>
    }
</div>

@section Scripts{
    <script>


        $("#submit").click(function (e) {
            e.preventDefault();

            var model = {
                MealId : $("input[name=MealId]").val(),
                Quantity : $("input[name=Quantity]").val()
            };

            $.ajax({
                url: "/ShoppingCart",
                type: "POST",
                    headers:
                    {
                        "RequestVerificationToken": '@GetAntiXsrfRequestToken()'
                    },
                
                data: model,
                success: function (data) {
                    $('#cart').remove();
                    $('#partialCart').html(data);
                    $('#modal').modal('toggle');
                    $('#modal').modal('show');
                    $('#modal').modal('hide');
                }
            });
        });
    </script>

}
<div class="modal hide fade" style="opacity:0.4;" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Meal added to cart</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Success</p>
            </div>
            <div class="modal-footer">
                <button id="modalClose" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
